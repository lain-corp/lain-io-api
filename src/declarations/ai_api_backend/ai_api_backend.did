type chat_message = variant {
  tool : record { content : text; tool_call_id : text };
  user : record { content : text };
  assistant : record {
    content : opt text;
    tool_calls : vec record {
      id : text;
      function : record {
        name : text;
        arguments : vec record {
          name : text;
          value : text;
        };
      }
    };
  };
  system : record { content : text };
};

type room_config = record {
  id : text;
  name : text;
  description : text;
};

type personality_embedding = record {
  text: text;
  embedding: vec float32;
  channel_id: text;
  category: text;
  importance: float32;
  created_at: nat64;
};

service: {
  chat: (vec chat_message, opt text) -> (text);
  chat_default: (vec chat_message) -> (text);
  chat_with_rag: (vec chat_message, opt text, vec float32) -> (text);
  get_available_rooms: () -> (vec room_config) query;
  store_personality: (personality_embedding) -> (text);
  store_personality_batch: (vec personality_embedding) -> (text);
  get_personality_embeddings: () -> (vec personality_embedding) query;
  search_personality: (text, vec float32) -> (vec text) query;
}