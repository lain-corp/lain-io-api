type chat_message = variant {
  tool : record { content : text; tool_call_id : text };
  user : record { content : text };
  assistant : record {
    content : opt text;
    tool_calls : vec record {
      id : text;
      function : record {
        name : text;
        arguments : vec record {
          name : text;
          value : text;
        };
      }
    };
  };
  system : record { content : text };
};

type room_config = record {
  id : text;
  name : text;
  description : text;
};

service: {
  chat: (vec chat_message, opt text) -> (text);
  chat_default: (vec chat_message) -> (text);
  chat_with_rag: (vec chat_message, opt text, vec float32) -> (text);
  get_available_rooms: () -> (vec room_config) query;
  store_personality: (text, text, text, float32, vec float32) -> ();
  store_personality_batch: (vec record { 
    channel: text; 
    content: text; 
    trait_type: text; 
    importance: float32; 
    embedding: vec float32 
  }) -> ();
  get_personality_embeddings: () -> (vec record { 
    channel: text; 
    content: text; 
    trait_type: text; 
    importance: float32; 
    embedding: vec float32 
  }) query;
}